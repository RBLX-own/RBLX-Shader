--// ULTRA ENHANCER - CENTERED SQUIRCLE ICON
--// Icon appears in center, movable, works as button

-- Wait for game to load
repeat task.wait() until game:IsLoaded()
repeat task.wait() until game.Players.LocalPlayer

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")

-- Get player
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Clear any existing GUI
if playerGui:FindFirstChild("UltraEnhancerGUI") then
    playerGui:FindFirstChild("UltraEnhancerGUI"):Destroy()
end

-- Create main GUI container
local gui = Instance.new("ScreenGui")
gui.Name = "UltraEnhancerGUI"
gui.ResetOnSpawn = false
gui.IgnoreGuiInset = true
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
gui.DisplayOrder = 999
gui.Parent = playerGui

print("ðŸŽ® Ultra Enhancer - Loading...")

----------------------------------------------------
-- STORAGE
----------------------------------------------------
local Storage = {
    popupShown = false,
    telegramClicked = false,
    shaderEnabled = false,
    iconPosition = {X = 0.5, Y = 0.5}, -- CENTER OF SCREEN
    windowPosition = {X = 0.5, Y = 0.5}
}

-- Save/Load
local function SaveSettings()
    _G.UltraEnhancer_Settings = Storage
end

local function LoadSettings()
    if _G.UltraEnhancer_Settings then
        for key, value in pairs(_G.UltraEnhancer_Settings) do
            Storage[key] = value
        end
    end
end

LoadSettings()

----------------------------------------------------
-- CENTERED SQUIRCLE ICON (MOVABLE BUTTON)
----------------------------------------------------
local movableIcon = nil
local isDraggingIcon = false
local dragStartPosition = nil
local iconStartPosition = nil

local function CreateCenteredIcon()
    print("ðŸŽ¯ Creating centered squircle icon...")
    
    -- Remove existing icon
    if movableIcon and movableIcon.Parent then
        movableIcon:Destroy()
    end
    
    -- Create the icon as a button
    movableIcon = Instance.new("ImageButton")
    movableIcon.Name = "CenterIcon"
    movableIcon.Size = UDim2.new(0, 100, 0, 100) -- Bigger for center
    movableIcon.AnchorPoint = Vector2.new(0.5, 0.5)
    movableIcon.AutoButtonColor = false
    movableIcon.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
    movableIcon.BackgroundTransparency = 0.1
    movableIcon.ZIndex = 10
    
    -- POSITION IN CENTER OF SCREEN
    local screenSize = workspace.CurrentCamera.ViewportSize
    movableIcon.Position = UDim2.new(
        Storage.iconPosition.X,
        Storage.iconPosition.X * screenSize.X,
        Storage.iconPosition.Y,
        Storage.iconPosition.Y * screenSize.Y
    )
    
    -- SQUIRCLE SHAPE (Modern rounded square)
    local corner = Instance.new("UICorner", movableIcon)
    corner.CornerRadius = UDim.new(0.25, 0) -- Squircle shape
    
    -- Glossy border
    local border = Instance.new("UIStroke", movableIcon)
    border.Color = Color3.fromRGB(100, 150, 255)
    border.Thickness = 3
    border.Transparency = 0.2
    
    -- Inner glow
    local innerGlow = Instance.new("Frame", movableIcon)
    innerGlow.Size = UDim2.new(1, -10, 1, -10)
    innerGlow.Position = UDim2.new(0, 5, 0, 5)
    innerGlow.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    innerGlow.BackgroundTransparency = 0.95
    innerGlow.BorderSizePixel = 0
    
    local glowCorner = Instance.new("UICorner", innerGlow)
    glowCorner.CornerRadius = UDim.new(0.2, 0)
    
    -- Icon content
    local content = Instance.new("Frame", movableIcon)
    content.Size = UDim2.new(0.7, 0, 0.7, 0)
    content.Position = UDim2.new(0.15, 0, 0.15, 0)
    content.BackgroundTransparency = 1
    
    -- Animated gradient
    local gradient = Instance.new("UIGradient", content)
    gradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(100, 200, 255)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(200, 100, 255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(100, 200, 255))
    })
    gradient.Rotation = 45
    
    -- Rotate gradient
    task.spawn(function()
        while movableIcon and movableIcon.Parent do
            gradient.Rotation = gradient.Rotation + 0.5
            if gradient.Rotation >= 360 then
                gradient.Rotation = 0
            end
            task.wait(0.03)
        end
    end)
    
    -- Icon symbol
    local iconSymbol = Instance.new("TextLabel", content)
    iconSymbol.Size = UDim2.new(1, 0, 1, 0)
    iconSymbol.Text = "âš¡"
    iconSymbol.Font = Enum.Font.GothamBold
    iconSymbol.TextSize = 42
    iconSymbol.TextColor3 = Color3.fromRGB(255, 255, 255)
    iconSymbol.BackgroundTransparency = 1
    
    -- Pulsing animation
    task.spawn(function()
        while movableIcon and movableIcon.Parent do
            TweenService:Create(iconSymbol, TweenInfo.new(0.8, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {
                TextSize = 46
            }):Play()
            task.wait(1.6)
        end
    end)
    
    -- DRAGGING FUNCTIONALITY
    movableIcon.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            isDraggingIcon = true
            dragStartPosition = Vector2.new(input.Position.X, input.Position.Y)
            iconStartPosition = movableIcon.Position
            
            -- Visual feedback for dragging
            TweenService:Create(movableIcon, TweenInfo.new(0.15), {
                Size = UDim2.new(0, 95, 0, 95),
                BackgroundTransparency = 0
            }):Play()
            TweenService:Create(border, TweenInfo.new(0.15), {
                Thickness = 4
            }):Play()
        end
    end)
    
    movableIcon.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            isDraggingIcon = false
            
            -- Save position
            local screenSize = workspace.CurrentCamera.ViewportSize
            Storage.iconPosition = {
                X = movableIcon.Position.X.Offset / screenSize.X,
                Y = movableIcon.Position.Y.Offset / screenSize.Y
            }
            SaveSettings()
            
            -- Visual feedback
            TweenService:Create(movableIcon, TweenInfo.new(0.15), {
                Size = UDim2.new(0, 100, 0, 100),
                BackgroundTransparency = 0.1
            }):Play()
            TweenService:Create(border, TweenInfo.new(0.15), {
                Thickness = 3
            }):Play()
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if isDraggingIcon and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = Vector2.new(
                input.Position.X - dragStartPosition.X,
                input.Position.Y - dragStartPosition.Y
            )
            
            local newPosition = UDim2.new(
                iconStartPosition.X.Scale,
                iconStartPosition.X.Offset + delta.X,
                iconStartPosition.Y.Scale,
                iconStartPosition.Y.Offset + delta.Y
            )
            
            movableIcon.Position = newPosition
        end
    end)
    
    -- CLICK FUNCTIONALITY - LOADS MAIN SCRIPT
    movableIcon.MouseButton1Click:Connect(function()
        if not isDraggingIcon then
            print("ðŸŽ¯ Squircle icon clicked - Loading main features...")
            
            -- Click animation
            TweenService:Create(movableIcon, TweenInfo.new(0.1), {
                Size = UDim2.new(0, 90, 0, 90)
            }):Play()
            
            -- Play sound
            pcall(function()
                local clickSound = Instance.new("Sound")
                clickSound.SoundId = "rbxassetid://4590662766"
                clickSound.Volume = 0.5
                clickSound.Parent = movableIcon
                clickSound:Play()
                game:GetService("Debris"):AddItem(clickSound, 2)
            end)
            
            task.wait(0.1)
            
            TweenService:Create(movableIcon, TweenInfo.new(0.1), {
                Size = UDim2.new(0, 100, 0, 100)
            }):Play()
            
            -- Check if main GUI already exists
            if gui:FindFirstChild("MainGUI") then
                print("ðŸ“± Main features already loaded")
                return
            end
            
            -- LOAD THE MAIN FEATURES
            CreateMainFeatures()
        end
    end)
    
    -- Hover effects
    movableIcon.MouseEnter:Connect(function()
        if not isDraggingIcon then
            TweenService:Create(movableIcon, TweenInfo.new(0.2), {
                Size = UDim2.new(0, 105, 0, 105),
                BackgroundTransparency = 0
            }):Play()
            TweenService:Create(border, TweenInfo.new(0.2), {
                Thickness = 4,
                Transparency = 0.1
            }):Play()
        end
    end)
    
    movableIcon.MouseLeave:Connect(function()
        if not isDraggingIcon then
            TweenService:Create(movableIcon, TweenInfo.new(0.2), {
                Size = UDim2.new(0, 100, 0, 100),
                BackgroundTransparency = 0.1
            }):Play()
            TweenService:Create(border, TweenInfo.new(0.2), {
                Thickness = 3,
                Transparency = 0.2
            }):Play()
        end
    end)
    
    -- Floating animation
    local floatOffset = Vector2.new(0, 0)
    local floatTime = 0
    
    task.spawn(function()
        while movableIcon and movableIcon.Parent do
            if not isDraggingIcon then
                floatTime = floatTime + 0.05
                floatOffset = Vector2.new(
                    math.sin(floatTime) * 4,
                    math.cos(floatTime * 0.8) * 4
                )
                
                movableIcon.Position = UDim2.new(
                    movableIcon.Position.X.Scale,
                    movableIcon.Position.X.Offset + floatOffset.X,
                    movableIcon.Position.Y.Scale,
                    movableIcon.Position.Y.Offset + floatOffset.Y
                )
            end
            task.wait(0.05)
        end
    end)
    
    movableIcon.Parent = gui
    
    print("âœ… Centered squircle icon created at screen center")
    return movableIcon
end

----------------------------------------------------
-- TELEGRAM POPUP (SHOWS FIRST)
----------------------------------------------------
local function CreateTelegramPopup()
    print("ðŸ“± Creating Telegram popup...")
    
    Storage.popupShown = true
    SaveSettings()
    
    -- Overlay
    local overlay = Instance.new("Frame", gui)
    overlay.Name = "PopupOverlay"
    overlay.Size = UDim2.new(1, 0, 1, 0)
    overlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    overlay.BackgroundTransparency = 0.6
    overlay.ZIndex = 15
    
    -- Popup
    local popup = Instance.new("Frame", overlay)
    popup.Name = "TelegramPopup"
    popup.Size = UDim2.new(0, 420, 0, 320)
    popup.Position = UDim2.new(0.5, 0, 0.5, 0)
    popup.AnchorPoint = Vector2.new(0.5, 0.5)
    popup.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
    popup.BackgroundTransparency = 0.05
    popup.ZIndex = 16
    
    local corner = Instance.new("UICorner", popup)
    corner.CornerRadius = UDim.new(0, 24)
    
    -- Glass effect
    local glass = Instance.new("Frame", popup)
    glass.Size = UDim2.new(1, 0, 1, 0)
    glass.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    glass.BackgroundTransparency = 0.98
    glass.BorderSizePixel = 0
    
    -- Telegram icon
    local tgIcon = Instance.new("TextLabel", popup)
    tgIcon.Size = UDim2.new(0, 80, 0, 80)
    tgIcon.Position = UDim2.new(0.5, -40, 0.1, 0)
    tgIcon.Text = "âœˆï¸"
    tgIcon.Font = Enum.Font.GothamBold
    tgIcon.TextSize = 48
    tgIcon.TextColor3 = Color3.fromRGB(34, 158, 217)
    tgIcon.BackgroundTransparency = 1
    
    -- Title
    local title = Instance.new("TextLabel", popup)
    title.Size = UDim2.new(1, -40, 0, 60)
    title.Position = UDim2.new(0, 20, 0, 100)
    title.Text = "Join Our Telegram Community"
    title.Font = Enum.Font.GothamBold
    title.TextSize = 22
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.BackgroundTransparency = 1
    
    -- Description
    local desc = Instance.new("TextLabel", popup)
    desc.Size = UDim2.new(1, -40, 0, 80)
    desc.Position = UDim2.new(0, 20, 0, 160)
    desc.Text = "Get exclusive scripts, tutorials, and daily updates from our growing community!"
    desc.Font = Enum.Font.Gotham
    desc.TextSize = 16
    desc.TextColor3 = Color3.fromRGB(200, 200, 220)
    desc.BackgroundTransparency = 1
    desc.TextWrapped = true
    
    -- Join button
    local joinBtn = Instance.new("TextButton", popup)
    joinBtn.Size = UDim2.new(0.8, 0, 0, 50)
    joinBtn.Position = UDim2.new(0.1, 0, 0, 250)
    joinBtn.Text = "Join Telegram"
    joinBtn.Font = Enum.Font.GothamBold
    joinBtn.TextSize = 18
    joinBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    joinBtn.BackgroundColor3 = Color3.fromRGB(34, 158, 217)
    
    local joinCorner = Instance.new("UICorner", joinBtn)
    joinCorner.CornerRadius = UDim.new(0, 12)
    
    -- Continue button
    local continueBtn = Instance.new("TextButton", popup)
    continueBtn.Size = UDim2.new(0.4, 0, 0, 40)
    continueBtn.Position = UDim2.new(0.3, 0, 0, 310)
    continueBtn.Text = "Continue"
    continueBtn.Font = Enum.Font.Gotham
    continueBtn.TextSize = 14
    continueBtn.TextColor3 = Color3.fromRGB(180, 180, 200)
    continueBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
    
    local continueCorner = Instance.new("UICorner", continueBtn)
    continueCorner.CornerRadius = UDim.new(0, 10)
    
    -- Animate in
    popup.Size = UDim2.new(0, 0, 0, 0)
    popup:TweenSize(UDim2.new(0, 420, 0, 320), "Out", "Back", 0.6, true)
    
    -- Button handlers
    joinBtn.MouseButton1Click:Connect(function()
        Storage.telegramClicked = true
        SaveSettings()
        
        local url = "https://t.me/RBLX_SCRIPTS_MYANMAR"
        
        -- Copy to clipboard
        pcall(function()
            if setclipboard then
                setclipboard(url)
                joinBtn.Text = "Link Copied!"
                task.wait(1)
                joinBtn.Text = "Join Telegram"
            end
        end)
        
        -- Close popup
        popup:TweenSize(UDim2.new(0, 0, 0, 0), "In", "Back", 0.4, true)
        task.wait(0.4)
        overlay:Destroy()
        
        -- Show centered icon after popup closes
        CreateCenteredIcon()
    end)
    
    continueBtn.MouseButton1Click:Connect(function()
        Storage.telegramClicked = false
        SaveSettings()
        
        -- Close popup
        popup:TweenSize(UDim2.new(0, 0, 0, 0), "In", "Back", 0.4, true)
        task.wait(0.4)
        overlay:Destroy()
        
        -- Show centered icon after popup closes
        CreateCenteredIcon()
    end)
    
    print("âœ… Telegram popup created")
end

----------------------------------------------------
-- MAIN FEATURES (Shader + FPS Boost)
----------------------------------------------------
local shaderEffects = {}

local function CreateMainFeatures()
    print("ðŸ–¥ï¸ Loading main features (Shader + FPS Boost)...")
    
    -- Create main interface
    local mainFrame = Instance.new("Frame", gui)
    mainFrame.Name = "MainGUI"
    mainFrame.Size = UDim2.new(0, 400, 0, 350)
    mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    mainFrame.BackgroundTransparency = 0.1
    mainFrame.Active = true
    mainFrame.Draggable = false
    
    -- Position at center
    local screenSize = workspace.CurrentCamera.ViewportSize
    mainFrame.Position = UDim2.new(
        Storage.windowPosition.X,
        Storage.windowPosition.X * screenSize.X,
        Storage.windowPosition.Y,
        Storage.windowPosition.Y * screenSize.Y
    )
    
    -- Style
    local corner = Instance.new("UICorner", mainFrame)
    corner.CornerRadius = UDim.new(0, 24)
    
    local stroke = Instance.new("UIStroke", mainFrame)
    stroke.Color = Color3.fromRGB(60, 60, 80)
    stroke.Thickness = 2
    
    -- Glass effect
    local glass = Instance.new("Frame", mainFrame)
    glass.Size = UDim2.new(1, 0, 1, 0)
    glass.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    glass.BackgroundTransparency = 0.97
    glass.BorderSizePixel = 0
    
    -- Title bar
    local titleBar = Instance.new("Frame", mainFrame)
    titleBar.Size = UDim2.new(1, 0, 0, 50)
    titleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
    titleBar.BorderSizePixel = 0
    
    local titleCorner = Instance.new("UICorner", titleBar)
    titleCorner.CornerRadius = UDim.new(0, 24, 0, 0)
    
    local title = Instance.new("TextLabel", titleBar)
    title.Size = UDim2.new(1, -40, 1, 0)
    title.Position = UDim2.new(0, 15, 0, 0)
    title.Text = "âš¡ Ultra Features"
    title.Font = Enum.Font.GothamBold
    title.TextSize = 20
    title.TextColor3 = Color3.fromRGB(220, 220, 255)
    title.BackgroundTransparency = 1
    title.TextXAlignment = Enum.TextXAlignment.Left
    
    -- Close button
    local closeBtn = Instance.new("TextButton", titleBar)
    closeBtn.Size = UDim2.new(0, 32, 0, 32)
    closeBtn.Position = UDim2.new(1, -42, 0.5, -16)
    closeBtn.Text = "Ã—"
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.TextSize = 28
    closeBtn.TextColor3 = Color3.fromRGB(255, 100, 100)
    closeBtn.BackgroundTransparency = 1
    
    closeBtn.MouseButton1Click:Connect(function()
        -- Save position
        local screenSize = workspace.CurrentCamera.ViewportSize
        Storage.windowPosition = {
            X = mainFrame.Position.X.Offset / screenSize.X,
            Y = mainFrame.Position.Y.Offset / screenSize.Y
        }
        SaveSettings()
        
        -- Close animation
        TweenService:Create(mainFrame, TweenInfo.new(0.3), {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0.5, 0)
        }):Play()
        
        -- Also close the icon
        if movableIcon and movableIcon.Parent then
            TweenService:Create(movableIcon, TweenInfo.new(0.3), {
                Size = UDim2.new(0, 0, 0, 0)
            }):Play()
        end
        
        task.wait(0.3)
        
        -- Cleanup
        mainFrame:Destroy()
        if movableIcon and movableIcon.Parent then
            movableIcon:Destroy()
            movableIcon = nil
        end
        
        print("âœ… Features closed, icon removed")
    end)
    
    -- Content area
    local content = Instance.new("Frame", mainFrame)
    content.Size = UDim2.new(1, -20, 1, -70)
    content.Position = UDim2.new(0, 10, 0, 60)
    content.BackgroundTransparency = 1
    
    -- ========== SHADER TOGGLE ==========
    local shaderCard = Instance.new("Frame", content)
    shaderCard.Size = UDim2.new(1, 0, 0, 80)
    shaderCard.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
    shaderCard.BackgroundTransparency = 0.1
    
    local shaderCorner = Instance.new("UICorner", shaderCard)
    shaderCorner.CornerRadius = UDim.new(0, 16)
    
    local shaderStroke = Instance.new("UIStroke", shaderCard)
    shaderStroke.Color = Color3.fromRGB(100, 150, 255)
    shaderStroke.Thickness = 2
    
    -- Shader title
    local shaderTitle = Instance.new("TextLabel", shaderCard)
    shaderTitle.Size = UDim2.new(1, -20, 0, 30)
    shaderTitle.Position = UDim2.new(0, 15, 0, 10)
    shaderTitle.Text = "ðŸŒŒ ULTRA SHADER"
    shaderTitle.Font = Enum.Font.GothamBold
    shaderTitle.TextSize = 16
    shaderTitle.TextColor3 = Color3.fromRGB(220, 220, 255)
    shaderTitle.BackgroundTransparency = 1
    shaderTitle.TextXAlignment = Enum.TextXAlignment.Left
    
    -- Shader toggle button
    local shaderBtn = Instance.new("TextButton", shaderCard)
    shaderBtn.Size = UDim2.new(0.6, 0, 0, 35)
    shaderBtn.Position = UDim2.new(0.2, 0, 0, 40)
    shaderBtn.Text = Storage.shaderEnabled and "DISABLE SHADER" or "ENABLE SHADER"
    shaderBtn.Font = Enum.Font.GothamBold
    shaderBtn.TextSize = 14
    shaderBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    shaderBtn.BackgroundColor3 = Storage.shaderEnabled and Color3.fromRGB(60, 100, 180) or Color3.fromRGB(40, 40, 60)
    
    local shaderBtnCorner = Instance.new("UICorner", shaderBtn)
    shaderBtnCorner.CornerRadius = UDim.new(0, 10)
    
    -- ========== FPS BOOST ==========
    local fpsCard = Instance.new("Frame", content)
    fpsCard.Size = UDim2.new(1, 0, 0, 80)
    fpsCard.Position = UDim2.new(0, 0, 0, 90)
    fpsCard.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
    fpsCard.BackgroundTransparency = 0.1
    
    local fpsCorner = Instance.new("UICorner", fpsCard)
    fpsCorner.CornerRadius = UDim.new(0, 16)
    
    local fpsStroke = Instance.new("UIStroke", fpsCard)
    fpsStroke.Color = Color3.fromRGB(100, 200, 100)
    fpsStroke.Thickness = 2
    
    -- FPS title
    local fpsTitle = Instance.new("TextLabel", fpsCard)
    fpsTitle.Size = UDim2.new(1, -20, 0, 30)
    fpsTitle.Position = UDim2.new(0, 15, 0, 10)
    fpsTitle.Text = "ðŸš€ FPS BOOST"
    fpsTitle.Font = Enum.Font.GothamBold
    fpsTitle.TextSize = 16
    fpsTitle.TextColor3 = Color3.fromRGB(220, 220, 255)
    fpsTitle.BackgroundTransparency = 1
    fpsTitle.TextXAlignment = Enum.TextXAlignment.Left
    
    -- FPS button
    local fpsBtn = Instance.new("TextButton", fpsCard)
    fpsBtn.Size = UDim2.new(0.6, 0, 0, 35)
    fpsBtn.Position = UDim2.new(0.2, 0, 0, 40)
    fpsBtn.Text = "BOOST FPS"
    fpsBtn.Font = Enum.Font.GothamBold
    fpsBtn.TextSize = 14
    fpsBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    fpsBtn.BackgroundColor3 = Color3.fromRGB(50, 180, 80)
    
    local fpsBtnCorner = Instance.new("UICorner", fpsBtn)
    fpsBtnCorner.CornerRadius = UDim.new(0, 10)
    
    -- ========== FPS COUNTER ==========
    local fpsCounterCard = Instance.new("Frame", content)
    fpsCounterCard.Size = UDim2.new(1, 0, 0, 70)
    fpsCounterCard.Position = UDim2.new(0, 0, 0, 180)
    fpsCounterCard.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
    fpsCounterCard.BackgroundTransparency = 0.1
    
    local fpsCounterCorner = Instance.new("UICorner", fpsCounterCard)
    fpsCounterCorner.CornerRadius = UDim.new(0, 16)
    
    local fpsCounterStroke = Instance.new("UIStroke", fpsCounterCard)
    fpsCounterStroke.Color = Color3.fromRGB(255, 150, 100)
    fpsCounterStroke.Thickness = 2
    
    -- FPS display
    local fpsDisplay = Instance.new("TextLabel", fpsCounterCard)
    fpsDisplay.Size = UDim2.new(1, 0, 1, 0)
    fpsDisplay.Text = "FPS: --"
    fpsDisplay.Font = Enum.Font.GothamBold
    fpsDisplay.TextSize = 24
    fpsDisplay.TextColor3 = Color3.fromRGB(100, 255, 150)
    fpsDisplay.BackgroundTransparency = 1
    
    -- Animate in
    mainFrame.Size = UDim2.new(0, 0, 0, 0)
    mainFrame:TweenSize(UDim2.new(0, 400, 0, 350), "Out", "Back", 0.5, true)
    
    -- ========== FUNCTIONALITY ==========
    
    -- SHADER TOGGLE
    shaderBtn.MouseButton1Click:Connect(function()
        Storage.shaderEnabled = not Storage.shaderEnabled
        SaveSettings()
        
        if Storage.shaderEnabled then
            -- Enable shader
            shaderBtn.Text = "DISABLE SHADER"
            TweenService:Create(shaderBtn, TweenInfo.new(0.3), {
                BackgroundColor3 = Color3.fromRGB(60, 100, 180)
            }):Play()
            
            -- Apply enhanced graphics
            Lighting.Ambient = Color3.fromRGB(25, 28, 35)
            Lighting.Brightness = 2.0
            Lighting.GlobalShadows = true
            Lighting.ShadowSoftness = 0.05
            Lighting.ClockTime = 14
            
            -- Create effects
            local bloom = Instance.new("BloomEffect", Lighting)
            bloom.Intensity = 0.3
            bloom.Size = 36
            bloom.Threshold = 0.85
            table.insert(shaderEffects, bloom)
            
            local colorCorrection = Instance.new("ColorCorrectionEffect", Lighting)
            colorCorrection.Brightness = 0.1
            colorCorrection.Contrast = 0.4
            colorCorrection.Saturation = 0.15
            table.insert(shaderEffects, colorCorrection)
            
            print("âœ… Ultra shader enabled")
        else
            -- Disable shader
            shaderBtn.Text = "ENABLE SHADER"
            TweenService:Create(shaderBtn, TweenInfo.new(0.3), {
                BackgroundColor3 = Color3.fromRGB(40, 40, 60)
            }):Play()
            
            -- Remove effects
            for _, effect in ipairs(shaderEffects) do
                if effect then
                    effect:Destroy()
                end
            end
            shaderEffects = {}
            
            -- Reset lighting
            Lighting.Ambient = Color3.fromRGB(127, 127, 127)
            Lighting.Brightness = 1
            
            print("âœ… Ultra shader disabled")
        end
    end)
    
    -- FPS BOOST
    fpsBtn.MouseButton1Click:Connect(function()
        -- Optimize game
        for _, obj in pairs(workspace:GetDescendants()) do
            if obj:IsA("BasePart") then
                obj.Material = Enum.Material.SmoothPlastic
            elseif obj:IsA("ParticleEmitter") or obj:IsA("Trail") then
                obj.Enabled = false
            end
        end
        
        settings().Rendering.QualityLevel = 1
        Lighting.GlobalShadows = true
        Lighting.FogEnd = 100000
        
        fpsBtn.Text = "OPTIMIZED!"
        TweenService:Create(fpsBtn, TweenInfo.new(0.3), {
            BackgroundColor3 = Color3.fromRGB(30, 150, 60)
        }):Play()
        
        task.wait(1.5)
        
        fpsBtn.Text = "BOOST FPS"
        TweenService:Create(fpsBtn, TweenInfo.new(0.3), {
            BackgroundColor3 = Color3.fromRGB(50, 180, 80)
        }):Play()
        
        print("âœ… Game optimized for FPS")
    end)
    
    -- FPS COUNTER
    local lastUpdate = tick()
    local frameCount = 0
    
    RunService.RenderStepped:Connect(function()
        frameCount = frameCount + 1
        local currentTime = tick()
        
        if currentTime - lastUpdate >= 1 then
            local fps = frameCount
            frameCount = 0
            lastUpdate = currentTime
            
            fpsDisplay.Text = string.format("FPS: %d", fps)
            
            -- Color coding
            if fps >= 60 then
                fpsDisplay.TextColor3 = Color3.fromRGB(100, 255, 150)
            elseif fps >= 30 then
                fpsDisplay.TextColor3 = Color3.fromRGB(255, 200, 100)
            else
                fpsDisplay.TextColor3 = Color3.fromRGB(255, 100, 100)
            end
        end
    end)
    
    print("âœ… Main features loaded successfully")
    return mainFrame
end

----------------------------------------------------
-- MAIN INITIALIZATION
----------------------------------------------------
print("ðŸš€ Starting Ultra Enhancer...")

-- Check if we should show Telegram popup first
if not Storage.popupShown then
    print("ðŸ“± First time - Showing Telegram popup")
    -- Don't show icon yet, popup will show it after Continue
    CreateTelegramPopup()
else
    print("ðŸ“± Telegram already seen - Showing icon directly")
    -- Show centered icon immediately
    CreateCenteredIcon()
end

-- Auto-save on game close
game:BindToClose(function()
    SaveSettings()
    print("ðŸ’¾ Settings saved")
end)

print("âœ… Ultra Enhancer ready!")
print("ðŸ‘‰ Click the blue squircle icon in the center to load features")

-- Simple notification function
local function ShowNotification(message)
    local notif = Instance.new("TextLabel")
    notif.Size = UDim2.new(0, 200, 0, 40)
    notif.Position = UDim2.new(0.5, -100, 0.9, 0)
    notif.Text = message
    notif.Font = Enum.Font.GothamBold
    notif.TextSize = 14
    notif.TextColor3 = Color3.fromRGB(255, 255, 255)
    notif.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    notif.BackgroundTransparency = 0.2
    notif.ZIndex = 20
    
    local corner = Instance.new("UICorner", notif)
    corner.CornerRadius = UDim.new(0, 8)
    
    notif.Parent = gui
    
    -- Animate in
    notif:TweenPosition(
        UDim2.new(0.5, -100, 0.85, 0),
        "Out",
        "Quad",
        0.3,
        true
    )
    
    -- Auto remove
    task.delay(3, function()
        if notif and notif.Parent then
            notif:TweenPosition(
                UDim2.new(0.5, -100, 0.9, 0),
                "In",
                "Quad",
                0.3,
                true
            )
            task.wait(0.3)
            notif:Destroy()
        end
    end)
end

-- Show initial notification
task.wait(1)
if not Storage.popupShown then
    ShowNotification("Welcome! Please check the Telegram popup")
else
    ShowNotification("Click the blue squircle icon to load features")
end